---
title: Usar el archivo de la API de la cadena de bloques de Stacks
description: Descubre cómo utilizar el Hiro Archive para poner en marcha una API de Stacks Blockchain.
---
## Requisitos previos

Dado que la API de Stacks Blockchain depende de que un nodo de la cadena de bloques Stacks esté a la misma altura de bloque, primero deberá [restaurar un nodo de blockchain de Stacks utilizando el Archivo Hiro](/resources/archive/stacks-blockchain) antes de restaurar la API de Stacks Blockchain. De lo contrario, puede encontrar errores al ejecutar la API.

Para que los archivos de la cadena de bloques Stacks y la API de la cadena de bloques Stacks sean compatibles, deben cumplir los siguientes criterios:

* Ambos archivos corresponden a la misma red de Stacks (mainnet/testnet).
* La versión del archivo API debe ser compatible con la versión del archivo de la cadena de bloques Stacks (Ver [Notas de la versión de la API](https://github.com/hirosystems/stacks-blockchain-api/releases) para orientación).
* Ambos archivos fueron creados en la misma fecha.

## Métodos de restauración

Hay dos formas de restaurar una API de Stacks Blockchain utilizando el Archivo Hiro. El archivo que necesitará descargar dependerá de su método de restauración. No existe ningún escenario en el que necesite ambos métodos de restauración.

**Restaurar mediante volcado de base de datos Postgres (Recomendado)**

Este es el método más rápido y directo, y es adecuado para la mayoría de los escenarios. Consiste en una copia de seguridad de la base de datos Postgres de la API tomada utilizando `pg_dump`Por lo general, recomendamos comenzar con este método antes de intentar el método siguiente si este no funciona por alguna razón.

**Restaurar mediante archivo de valores separados por tabulaciones (TSV)**

Este método es varias veces más lento que la restauración desde un volcado de Postgres. El archivo TSV de la API contiene los eventos sin procesar en bruto de un nodo de la cadena de bloques de Stacks. La API puede ingerir este archivo para procesar eventos en una base de datos Postgres.
La restauración desde un archivo TSV puede ser útil cuando no está disponible un archivo de base de datos Postgres para una versión particular de la API o cuando no se puede utilizar por cualquier motivo.

## Dónde descargar archivos

Dependiendo del método de restauración utilizado anteriormente, los archivos del Stacks Blockchain API para cada red se pueden encontrar en las siguientes ubicaciones:

* Volcado de base de datos Postgres
  * mainnet: https://archive.hiro.so/mainnet/stacks-blockchain-api-pg/
  * testnet: https://archive.hiro.so/testnet/stacks-blockchain-api-pg/
* Archivo TSV
  * mainnet: https://archive.hiro.so/mainnet/stacks-blockchain-api/
  * testnet: https://archive.hiro.so/testnet/stacks-blockchain-api/

Los patrones de nombres de archivo son los siguientes:

* Volcado de base de datos Postgres
  * archivo: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-<DATE(YYYYMMDD)>.dump`
  * shasum: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-<DATE(YYYYMMDD)>.sha256`
* Archivo TSV
  * archivo: `<network>-stacks-blockchain-api-<API VERSION>-<DATE(YYYYMMDD)>.gz`
  * shasum: `<network>-stacks-blockchain-api-<API VERSION>-<DATE(YYYYMMDD)>.sha256`

Existe un archivo y un shasum que se actualizan continuamente y siempre apuntan a la carga más reciente:

* Volcado de base de datos Postgres
  * archivo: `stacks-blockchain-api-pg-<DATABASE VERSION>-latest.dump`
  * shasum: `stacks-blockchain-api-pg-<DATABASE VERSION>-latest.sha256`
* Archivo TSV
  * archivo: `<network>-stacks-blockchain-api-latest.gz`
  * shasum: `<network>-stacks-blockchain-api-latest.sha256`

o la carga más reciente para una versión en particular:

* Volcado de base de datos Postgres
  * archivo: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-latest.dump`
  * shasum: `stacks-blockchain-api-pg-<DATABASE VERSION>-<API VERSION>-latest.sha256`
* Archivo TSV
  * archivo: `<network>-stacks-blockchain-api-<API VERSION>-latest.gz`
  * shasum: `<network>-stacks-blockchain-api-<API VERSION>-latest.sha256`

## Restaurando la API de la cadena de bloques de Stacks utilizando el archivo de Hiro

**Si se restaura mediante un volcado de Postgres**

1. Descargue el archivo y el shasum para la red y el método de restauración apropiados.
2. Verifique el archivo usando los pasos en el [descargar guía](/resources/archive/download-guide#verification-and-extraction) (note: API archives may not have SHA256 files available).
3. Importe el archivo de archivo en una base de datos Postgres en ejecución (puede tardar hasta una hora dependiendo de las especificaciones y la configuración de la base de datos):
   ```terminal
   $ export PGPASSWORD=<YOUR POSTGRES PASSWORD>
   $ pg_restore --username postgres --verbose --jobs 4 --dbname stacks_blockchain_api /path/to/archive/file
   ```
4. Inicie el servicio de API de Stacks Blockchain.
5. Verifique que el conjunto de datos se esté utilizando comparando sus nodos [altura del bloque local](http://localhost:3999/extended/v1/status) con [De Hiro](https://api.hiro.so/extended/v1/status)Si la altura del bloque coincide o está cerca de la altura del bloque de Hiro, la restauración fue exitosa.
   1. Es posible que el nodo local tarde unos minutos en responder en este punto final.
   2. Es posible que la altura de su bloque esté hasta unos cientos de bloques alejada de la de Hiro, dependiendo de la antigüedad del archivo. Debería ponerse al día relativamente rápido.

**Si se restaura mediante archivo TSV**

1. Descargue el archivo y el shasum para la red y el método de restauración apropiados.
2. Verifique el archivo usando los pasos en el [descargar guía](/resources/archive/download-guide#verification-and-extraction) (note: API archives may not have SHA256 files available).
3. Extraiga el archivo en el directorio deseado:
   ```terminal
   $ gzip -d <ARCHIVE FILE> --stdout > /path/to/extracted/file
   ```
4. [Siga estas instrucciones](https://github.com/hirosystems/stacks-blockchain-api#export-and-import) para procesar e importar los eventos del archivo TSV en su base de datos Postgres.
5. Inicie el servicio de API de Stacks Blockchain.
6. Verifique que el conjunto de datos se esté utilizando comparando sus nodos [altura del bloque local](http://localhost:3999/extended/v1/status) con [De Hiro](https://api.hiro.so/extended/v1/status)Si la altura del bloque coincide o está cerca de la altura del bloque de Hiro, la restauración fue exitosa.
   1. Es posible que el nodo local tarde unos minutos en responder en este punto final.
   2. Es posible que la altura de su bloque esté hasta unos cientos de bloques alejada de la de Hiro, dependiendo de la antigüedad del archivo. Debería ponerse al día relativamente rápido.
