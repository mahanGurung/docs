---
title: Ejemplos de uso
sidebarTitle: Uso
description: Aprende la funcionalidad central de Chainhook a través de ejemplos prácticos - predicados, ámbitos de eventos, manejo de reorganizaciones y modos de operación.
---
## Predicados

Los predicados son especificaciones JSON que indican a Chainhook qué eventos de blockchain monitorear y cómo responder. Siguen un patrón de si-esto-entonces-aquello.

```json stx-transfer-predicate.json
{
  "chain": "stacks",
  "uuid": "1",
  "name": "Monitor STX Transfers",
  "version": 1,
  "networks": {
    "mainnet": {
      "if_this": {
        "scope": "stx_event",
        "actions": ["transfer"]
      },
      "then_that": {
        "http_post": {
          "url": "https://api.example.com/stx-transfers",
          "authorization_header": "Bearer secret-token"
        }
      },
      "start_block": 100000
    }
  }
}
```

Este predicado monitorea todos los eventos de transferencia de STX a partir del bloque 100,000 y los envía a tu punto final de webhook.

### Componentes del predicado

```json
{
  "chain": "bitcoin",              // Target blockchain: "bitcoin" or "stacks"
  "uuid": "unique-id-123",         // Unique identifier for tracking
  "name": "My Bitcoin Monitor",    // Human-readable name
  "version": 1,                    // Predicate version
  "networks": {                    // Network-specific configurations
    "mainnet": { ... },
    "testnet": { ... }
  }
}
```

## Ámbitos de eventos

Cada blockchain admite diferentes tipos de eventos. Los ámbitos definen qué eventos específicos coincidirán con tu predicado.

### Eventos de Stacks

```json contract-call-predicate.json
{
  "if_this": {
    "scope": "contract_call",
    "contract_identifier": "SP2C2YFP12AJZB4MABJBAJ55XECVS7E4PMMZ89YZR.arkadiko-oracle-v2-3",
    "method": "update-price"
  }
}
```

Monitorea llamadas a funciones específicas de contratos. Ámbitos de Stacks disponibles:

* `stx_event` - Transferencias de STX, acuñaciones, quemas
* `contract_call` - Llamadas a funciones de contratos inteligentes
* `contract_deployment` - Nuevos despliegues de contratos
* `print_event` - Declaraciones de impresión del contrato
* `ft_event` - Operaciones de tokens fungibles
* `nft_event` - Operaciones de tokens no fungibles

### Eventos de Bitcoin

```json bitcoin-ordinals-predicate.json
{
  "if_this": {
    "scope": "ordinals_protocol",
    "operation": "inscription_feed"
  }
}
```

Rastrea inscripciones ordinales de Bitcoin. Ámbitos de Bitcoin disponibles:

* `p2pkh`, `p2sh`, `p2wpkh`, `p2tr` - Tipos de dirección
* `ordinals_protocol` - Inscripciones ordinales
* `stacks_protocol` - Operaciones de Bitcoin específicas de Stacks

## Manejadores de acciones

Define cómo Chainhook responde cuando los eventos coinciden con tus criterios de predicado.

### Entrega de webhook

```json webhook-config.json
{
  "then_that": {
    "http_post": {
      "url": "https://api.myapp.com/events",
      "authorization_header": "Bearer ${WEBHOOK_SECRET}"
    }
  }
}
```

Chainhook envía eventos coincidentes a tu endpoint mediante POST con el encabezado de autorización.

### Salida de archivo

```json file-output-config.json
{
  "then_that": {
    "file_append": {
      "path": "/data/blockchain-events.jsonl"
    }
  }
}
```

Agregar eventos a un archivo local, un objeto JSON por línea.

## Reorganizaciones de blockchain

Chainhook maneja automáticamente las reorganizaciones de la cadena de bloques (reorgs) enviando eventos tanto de retroceso como de aplicación.

```json reorg-event.json
{
  "apply": [
    {
      "block_identifier": {
        "index": 792101,
        "hash": "0x123..."
      },
      "transactions": [
        // New canonical chain transactions
      ]
    }
  ],
  "rollback": [
    {
      "block_identifier": {
        "index": 792100,
        "hash": "0x456..."
      },
      "transactions": [
        // Transactions to rollback
      ]
    }
  ]
}
```

Su aplicación debe manejar ambos tipos de eventos para mantener la consistencia de los datos durante las reorganizaciones.

### Manejo de eventos de reorganización

```typescript webhook-handler.ts
app.post('/chainhook-events', (req, res) => {
  const { apply, rollback } = req.body;
  
  // First, rollback orphaned transactions
  if (rollback) {
    for (const block of rollback) {
      await removeTransactions(block.transactions);
    }
  }
  
  // Then apply new canonical transactions
  if (apply) {
    for (const block of apply) {
      await processTransactions(block.transactions);
    }
  }
  
  res.status(200).send('OK');
});
```

## Modos de operación

Chainhook opera en dos modos principales según su caso de uso.

### Modo de escaneo

Analiza datos históricos de blockchain escaneando bloques archivados:

```terminal
$ chainhook predicates scan my-predicate.json --mainnet
```

Utiliza el modo de escaneo para:

* Probando predicados antes del despliegue
* Analizando eventos pasados de blockchain
* Rellenando datos históricos

### Modo de servicio

Monitorea eventos de blockchain en vivo en tiempo real:

```terminal
$ chainhook service start --config-path=config.toml
```

```toml config.toml
[http_api]
http_port = 20456
database_uri = "redis://localhost:6379"

[network]
mode = "mainnet"
bitcoind_rpc_url = "http://localhost:8332"
stacks_node_rpc_url = "http://localhost:20443"
```

El modo de servicio mantiene conexiones persistentes con los nodos de la cadena de bloques y procesa nuevos bloques a medida que llegan.

## Configuración de red

Configura los predicados de manera diferente para cada entorno de red:

```json multi-network-predicate.json
{
  "networks": {
    "mainnet": {
      "start_block": 100000,
      "if_this": {
        "scope": "stx_event",
        "actions": ["transfer", "mint"]
      }
    },
    "testnet": {
      "start_block": 1,
      "decode_clarity_values": true,
      "include_proof": true,
      "if_this": {
        "scope": "print_event"
      }
    }
  }
}
```

### Opciones de configuración

```json
{
  "start_block": 100000,           // Begin scanning from this block
  "end_block": 200000,             // Stop at this block (optional)
  "expire_after_occurrence": 5000, // Stop after N matches
  "decode_clarity_values": true,   // Decode Clarity data types
  "include_proof": false,          // Include merkle proofs
  "include_contract_abi": true     // Include contract interfaces
}
```

## Lecturas adicionales

* [Diseñar predicados](/tools/chainhook/usage)
* [Ejecutar Chainhook como un servicio](/tools/chainhook/service-mode)
