---
title: Validando tus contratos
sidebarTitle: Validaci√≥n y an√°lisis
description: Clarinet proporciona herramientas poderosas para validar, analizar y depurar sus contratos inteligentes. Desde la comprobaci√≥n est√°tica de tipos hasta el an√°lisis de costos en tiempo real, puede asegurarse de que sus contratos sean correctos y eficientes antes de la implementaci√≥n.
---
La validaci√≥n de contratos en el desarrollo de Clarity abarca an√°lisis est√°tico, depuraci√≥n en tiempo de ejecuci√≥n y optimizaci√≥n de costos. Cada enfoque sirve para diferentes prop√≥sitos en la garant√≠a de la correcci√≥n y eficiencia del contrato.

## Comprendiendo la validaci√≥n de contratos

**An√°lisis Est√°tico vs Depuraci√≥n en Tiempo de Ejecuci√≥n**

| Static Analysis             | Runtime Debugging            |
|-----------------------------|------------------------------|
| Detecta errores antes del despliegue | Revela el comportamiento durante la ejecuci√≥n |
| Incompatibilidades de tipos, errores de sintaxis | Costos reales de ejecuci√≥n |
| Violaciones de cumplimiento de rasgos | Cambios de estado y efectos secundarios |
| Uso de variables no definidas | Flujo y resultados de transacciones |
| Problemas con firmas de funciones | Cuellos de botella de rendimiento |

## An√°lisis est√°tico

El `clarinet check` el comando realiza una validaci√≥n exhaustiva de sus contratos sin ejecutarlos:

```terminal
$ clarinet check
[32m‚úî[0m [1m3 contracts checked[0m
```

Cuando la validaci√≥n falla, Clarinet proporciona diagn√≥sticos detallados:

```terminal
$ clarinet check
[31m‚úñ[0m [1m1 error detected[0m
[31mError in contracts/token.clar:15:10[0m
  |
15|  (ok (+ balance amount))
  |         ^^^^^^^
  |
  = [1mType error: expected uint, found (response uint uint)[0m
```

**Alcance de validaci√≥n**

Clarinet valida m√∫ltiples aspectos de tus contratos:

| Tipo de validaci√≥n | Qu√© verifica |
|----------------|----------------|
| **Seguridad de tipos** | Par√°metros de funci√≥n, valores de retorno, tipos de variables |
| **Cumplimiento de rasgos** | La implementaci√≥n coincide con las definiciones de rasgos |
| **Consistencia de respuesta** | Las ramas ok/err devuelven los mismos tipos |
| **√Åmbito de variables** | Todas las variables definidas antes de su uso |
| **Visibilidad de funciones** | Modificadores p√∫blicos/privados/de solo lectura |

**Verificando contratos espec√≠ficos**

Validar contratos individuales durante el desarrollo enfocado:

```terminal
$ clarinet check contracts/nft.clar
[32m‚úî[0m [1mcontracts/nft.clar Syntax of contract successfully checked[0m
```

**Integraci√≥n con CI**

Automatice la validaci√≥n en su pipeline de integraci√≥n continua. Por ejemplo, utilice GitHub Actions:

```yaml .github/workflows/validate.yml -c
name: Contract Validation
on: [push, pull_request]

jobs:
  sanity-checks:
    runs-on: ubuntu-latest
    container: hirosystems/clarinet:latest
    steps:
      - uses: actions/checkout@v4
      - name: Check Clarity contracts check
        run: clarinet check --use-on-disk-deployment-plan
      - name: Check Clarity contracts format
        run: clarinet format --check
```

## An√°lisis de tiempo de ejecuci√≥n

La consola de Clarinet proporciona potentes herramientas de an√°lisis en tiempo de ejecuci√≥n que le permiten inspeccionar el comportamiento del contrato durante la ejecuci√≥n.

### **An√°lisis de costos con `::toggle_costs`**

Habilitar la visualizaci√≥n autom√°tica del costo despu√©s de cada expresi√≥n:

```terminal
$ clarinet console
$ ::toggle_costs
[1mAlways show costs: true[0m
$ (contract-call? .counter count-up)
[1m+----------------------+----------+------------+------------+
|                      | Consumed | Limit      | Percentage |
|----------------------+----------+------------+------------|
| Runtime              | 4775     | 5000000000 | 0.00 %     |
|----------------------+----------+------------+------------|
| Read count           | 5        | 15000      | 0.03 %     |
|----------------------+----------+------------+------------|
| Read length (bytes)  | 268      | 100000000  | 0.00 %     |
|----------------------+----------+------------+------------|
| Write count          | 1        | 15000      | 0.01 %     |
|----------------------+----------+------------+------------|
| Write length (bytes) | 41       | 15000000   | 0.00 %     |
+----------------------+----------+------------+------------+[0m
[1m(ok true)[0m
```

### **Trazado de ejecuci√≥n con `::trace`**

Rastree las llamadas de funci√≥n para comprender el flujo de ejecuci√≥n:

```terminal
$ ::trace (contract-call? .defi-pool swap u100 'token-a 'token-b)
(contract-call? .defi-pool swap u100 'token-a 'token-b) [1m<console>[0m
( get-pool-balance 'token-a ) [1mdefi-pool:15:8[0m
  [31m‚Ü≥ args:[0m [1m'token-a[0m
    [1mu50000[0m
( get-pool-balance 'token-b ) [1mdefi-pool:16:8[0m
  [31m‚Ü≥ args:[0m [1m'token-b[0m
    [1mu75000[0m
( calculate-output u100 u50000 u75000 ) [1mdefi-pool:18:12[0m
  [31m‚Ü≥ args:[0m [1mu100, u50000, u75000[0m
    [1mu149[0m
[1m(ok u149)[0m
```

### **Depuraci√≥n interactiva con `::debug`**

Establece puntos de interrupci√≥n y avanza paso a paso por la ejecuci√≥n:

```terminal
$ ::debug (contract-call? .complex-contract process-batch)
$ break validate-input
[32mBreakpoint set at validate-input[0m
$ continue
[33mHit breakpoint at validate-input:23[0m
```

Comandos de navegaci√≥n de depuraci√≥n:

* `step` o `s` - Entrar en sub-expresiones
* `finish` o `f` - Completar la expresi√≥n actual
* `next` o `n` - Pasar por encima de sub-expresiones
* `continue` o `c` - Continuar hasta el siguiente punto de interrupci√≥n

### **Usando `::get_costs` para analizar los costos de funciones espec√≠ficas**

```terminal
$ ::get_costs (contract-call? .defi-pool add-liquidity u1000 u1000)
[1m+----------------------+----------+------------+------------+
|                      | Consumed | Limit      | Percentage |
|----------------------+----------+------------+------------|
| Runtime              | 12250    | 5000000000 | 0.00 %     |
|----------------------+----------+------------+------------|
| Read count           | 6        | 15000      | 0.04 %     |
|----------------------+----------+------------+------------|
| Read length (bytes)  | 192      | 100000000  | 0.00 %     |
|----------------------+----------+------------+------------|
| Write count          | 3        | 15000      | 0.02 %     |
|----------------------+----------+------------+------------|
| Write length (bytes) | 96       | 15000000   | 0.00 %     |
+----------------------+----------+------------+------------+[0m
[1m(ok {lp-tokens: u1000})[0m
```

### **Identificando y optimizando operaciones costosas utilizando `::trace`**

```terminal
$ ::trace (contract-call? .complex-algo process-large-dataset)
```

Buscar:

* Bucles con altos conteos de iteraci√≥n
* Operaciones anidadas de mapeo/filtrado
* Llamadas repetidas a contratos
* Manipulaciones de estructuras de datos grandes

## Flujos de trabajo de depuraci√≥n

Domina la depuraci√≥n interactiva para identificar problemas r√°pidamente iniciando una sesi√≥n de depuraci√≥n:

```terminal
$ clarinet console
$ ::debug (contract-call? .counter count-up)
[1mST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.counter[0m[1m:9:3[0m
   6
   7      ;; Increment the count for the caller
   8      (define-public (count-up)
-> 9        (ok (map-set counters tx-sender (+ (get-count tx-sender) u1)))
            ^
   10     )
   11
   12     ;; Get the current count for a user
(debug)
$ continue
```

### **Analizando transacciones fallidas usando `::trace`**

```terminal
$ ::trace (contract-call? .marketplace purchase u999)
(contract-call? .marketplace purchase u999) [1m<console>[0m
( get-listing u999 ) [1mmarketplace:45:12[0m
  [31m‚Ü≥ args:[0m [1mu999[0m
    [1mnone[0m
[31m(err u404)[0m  [1m# Listing not found[0m
```

### **Usando `::encode` y `::decode` para inspecci√≥n de datos**

Depurar estructuras de datos complejas:

```terminal
$ ::encode { id: u1, active: true }
[32m0c0000000206616374697665030269640100000000000000000000000000000001[0m
$ ::decode 0d0000000b48656c6c6f20776f726c64
[32m"Hello world"[0m
```

### **Probando la l√≥gica dependiente del tiempo**

```terminal
$ ::get_block_height
[1mCurrent block height: 4[0m
$ ::advance_chain_tip 100
[32mnew burn height: 3[0m
[32mnew stacks height: 104[0m
$ (contract-call? .vesting claim)
[32m(ok {claimed: u2500, remaining: u7500})[0m
```

## Pr√≥ximos pasos

:::next-steps
* [Despliegue](/tools/clarinet/deployment): Aprende c√≥mo desplegar tu proyecto de Clarinet.
* [SDK de Clarinet](/tools/clarinet/sdk-introduction): Aprende c√≥mo usar el SDK de Clarinet.
:::
